{% comment %}
  Shared template for Element selection logic
  This file calculates which element to display based on user configuration:
  - Daily Rotation: Cycles through all 118 elements based on day of year
  - Hourly Random: Shows a different element each hour based on hour identifier
{% endcomment %}

{% comment %}
  Load elements array from static data (data-all.json)
  The 'elements' key is automatically available from the static data configuration
{% endcomment %}
{% assign all_elements = elements %}

{% comment %} Get user's display mode preference (daily or hourly) {% endcomment %}
{% assign display_mode = trmnl.plugin_settings.custom_fields_values.display_mode | default: "daily" %}

{% if display_mode == "hourly" %}
  {% comment %} Hourly mode: Calculate element based on current hour {% endcomment %}
  {% assign current_year = "now" | date: "%Y" %}
  {% assign current_month = "now" | date: "%m" %}
  {% assign current_day = "now" | date: "%d" %}
  {% assign current_hour = "now" | date: "%H" %}
  {% assign hour_identifier = current_year | append: current_month | append: current_day | append: current_hour %}
  {% assign hour_id_number = hour_identifier | plus: 0 %}
  {% assign total_elements = all_elements | size %}
  {% assign element_index = hour_id_number | modulo: total_elements %}
{% else %}
  {% comment %} Daily mode: Calculate element based on day of year (default) {% endcomment %}
  {% assign current_date = "now" | date: "%s" %}
  {% assign year_start = "now" | date: "%Y-01-01" | date: "%s" %}
  {% assign seconds_diff = current_date | minus: year_start %}
  {% assign day_of_year = seconds_diff | divided_by: 86400 | plus: 1 %}
  {% assign total_elements = all_elements | size %}
  {% assign element_index = day_of_year | modulo: total_elements %}
{% endif %}

{% comment %}
  DEV TESTING: Override element_index to test specific elements
  Uncomment the line below and set to desired element index (0-117) to test specific elements
  Examples:
  - Element 99 (Einsteinium, 252.0830): {% assign element_index = 98 %}
  - Element 100 (Fermium, 257.09511): {% assign element_index = 99 %}
  - Element 101 (Mendelevium, 258.09843): {% assign element_index = 100 %}
  - Element 102 (Nobelium, 259.10100): {% assign element_index = 101 %}
  - Element 59 (Praseodymium, long name): {% assign element_index = 58 %}
  - Element 104 (Rutherfordium, longest name): {% assign element_index = 103 %}
  
  To disable override: Simply comment out or delete the override line below
{% endcomment %}
{% comment %} {% assign element_index = 99 %} {% endcomment %}

{% comment %} Get the element for this period {% endcomment %}
{% assign element = all_elements[element_index] %}

{% comment %} Atom icon for title bar {% endcomment %}
{%- capture icon_atom -%}
data:image/svg+xml,%3Csvg height='800' viewBox='0 0 1024 1024' width='800' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='m512 960c-92.8 0-160-200-160-448s67.2-448 160-448 160 200 160 448-67.2 448-160 448zm0-32c65.6 0 128-185.6 128-416s-62.4-416-128-416-128 185.6-128 416 62.4 416 128 416z'/%3E%3Cpath d='m124.8 736c-48-80 92.8-238.4 307.2-363.2s420.8-164.8 467.2-84.8-92.8 238.4-307.2 363.2-420.8 164.8-467.2 84.8zm27.2-16c33.6 57.6 225.6 17.6 424-97.6s329.6-260.8 296-318.4-225.6-17.6-424 97.6-329.6 260.8-296 318.4z'/%3E%3Cpath d='m899.2 736c-46.4 80-254.4 38.4-467.2-84.8s-355.2-283.2-307.2-363.2 254.4-38.4 467.2 84.8 355.2 283.2 307.2 363.2zm-27.2-16c33.6-57.6-97.6-203.2-296-318.4s-392-155.2-424-97.6 97.6 203.2 296 318.4 392 155.2 424 97.6z'/%3E%3Cpath d='m512 592c-44.8 0-80-35.2-80-80s35.2-80 80-80 80 35.2 80 80-35.2 80-80 80zm-240-280c-27.2 0-48-20.8-48-48s20.8-48 48-48 48 20.8 48 48-20.8 48-48 48zm144 568c-27.2 0-48-20.8-48-48s20.8-48 48-48 48 20.8 48 48-20.8 48-48 48zm448-432c-27.2 0-48-20.8-48-48s20.8-48 48-48 48 20.8 48 48-20.8 48-48 48z'/%3E%3C/svg%3E
{%- endcapture -%}

{% comment %}
  The 'element' variable is now available with the following properties:
  - element.atomic_number
  - element.symbol
  - element.name
  - element.atomic_mass
  - element.cpk_hex_color
  - element.electron_configuration
  - element.electronegativity
  - element.atomic_radius
  - element.ionization_energy
  - element.electron_affinity
  - element.oxidation_states
  - element.standard_state
  - element.melting_point
  - element.boiling_point
  - element.density
  - element.category
  - element.year_discovered
{% endcomment %}
